const express = require('express')
var cookieParser = require('cookie-parser');
const seralize = require('node-serialize');

const app = express()
app.use(cookieParser());

app.get('/', (req, res) => {
    try {
        let profile = req.cookies["profile"];
        let buffer = Buffer.from(profile, 'base64');
        profile = buffer.toString('utf-8');
        console.log(profile);
        let human = seralize.unserialize(profile);
        res.end(human["username"]);
    } catch (e) {
        res.cookie('profile', Buffer.from('{"username":"TheUndead","country":"worldwide","city":"Tyr"}', 'ascii').toString('base64'));
        res.end(`<html>
        <head>
            <meta charset="utf-8">
            <title>Hello vulhub!</title>
        </head>
        <body>
        </body>
    </html>`);
    }
})


app.listen(3000, () => console.log('Example app listening on port 3000!'))